-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
vRP = Proxy.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
cRP = {}
Tunnel.bindInterface("chest",cRP)
vSERVER = Tunnel.getInterface("chest")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
local chestOpen = ""
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHESTCOORDS
-----------------------------------------------------------------------------------------------------------------------------------------
local chestCoords = {
	{ "Police",-791.41,-1225.45,6.86,325.99 },
	{ "Police",-446.32,6008.84,31.71,226.78 },
	{ "Police",-944.96,-2040.81,9.4,136.07 },
	{ "Police",1844.3,2574.15,46.02,184.26 },
	{ "Paramedic",1135.3,-1540.49,35.38,90.71 },
	{ "Paramedic",1831.1,3678.57,34.27,22.68},
	{ "Paramedic",-258.01,6332.26,32.42,45.36 },
	{ "Favela01",1393.28,-187.85,161.56,229.61 }, --Ballas
	{ "Favela02",2249.77,52.44,251.42,65.2 }, --Vagos
	{ "Favela03",1713.17,446.63,232.83,223.94 }, --Families
 	{ "Favela04",2995.73,3031.61,105.73,317.49 }, --Aztecas
	{ "DaNang",226.41,-1753.93,25.24,48.19 },
	{ "Favela05",-167.44,3203.15,54.73,294.81 }, --Crips
	{ "Fleeca",413.35,-1498.43,33.8,28.35 },
	{ "Triads",-999.41,-1026.18,2.19,300.48 },
	{ "EastSide",1145.85,-1658.79,36.46,36.86 },
	{ "Rednecks",1941.79,3845.77,32.13,206.93 },
	{ "Marabunta",1407.95,-1542.11,54.71,235.28 },
	{ "Bullguer",-579.61,-881.35,26.0,269.3,true },
	{ "Bullguer",-578.25,-881.19,25.91,87.88,true }
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- THREADTARGET
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	SetNuiFocus(false,false)

	for k,v in pairs(chestCoords) do
		if v[6] then
			exports["target"]:AddCircleZone("chest:"..k,vector3(v[2],v[3],v[4]),1.0,{
				name = "chest:"..k,
				heading = v[5]
			},{
				shop = k,
				distance = 1.0,
				options = {
					{
						event = "chest:openSystem",
						label = "Abrir",
						tunnel = "shop"
					}
				}
			})
		else
			exports["target"]:AddCircleZone("chest:"..k,vector3(v[2],v[3],v[4]),1.0,{
				name = "chest:"..k,
				heading = v[5]
			},{
				shop = k,
				distance = 1.0,
				options = {
					{
						event = "chest:openSystem",
						label = "Abrir",
						tunnel = "shop"
					},{
						event = "chest:upgradeSystem",
						label = "Aumentar",
						tunnel = "shop"
					}
				}
			})
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHEST:OPENSYSTEM
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("chest:openSystem",function(shopId)
	if vSERVER.checkIntPermissions(chestCoords[shopId][1]) then
		SetNuiFocus(true,true)
		chestOpen = chestCoords[shopId][1]
		SendNUIMessage({ action = "showMenu" })
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHEST:UPGRADESYSTEM
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("chest:upgradeSystem",function(shopId)
	vSERVER.upgradeSystem(chestCoords[shopId][1])
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHESTCLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("invClose",function(data)
	SendNUIMessage({ action = "hideMenu" })
	SetNuiFocus(false,false)
	chestOpen = ""
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TAKEITEM
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("takeItem",function(data)
	vSERVER.takeItem(data["item"],data["slot"],data["amount"],data["target"],chestOpen)
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- STOREITEM
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("storeItem",function(data)
	vSERVER.storeItem(data["item"],data["slot"],data["amount"],data["target"],chestOpen)
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- UPDATESLOT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("updateChest",function(data,cb)
	vSERVER.updateChest(data["slot"],data["target"],data["amount"],chestOpen)
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- REQUESTCHEST
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("requestChest",function(data,cb)
	local myInventory,myChest,invPeso,invMaxpeso,chestPeso,chestMaxpeso = vSERVER.openChest(chestOpen)
	if myInventory then
		cb({ myInventory = myInventory, myChest = myChest, invPeso = invPeso, invMaxpeso = invMaxpeso, chestPeso = chestPeso, chestMaxpeso = chestMaxpeso })
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHEST:UPDATE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("chest:Update")
AddEventHandler("chest:Update",function(action)
	SendNUIMessage({ action = action })
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CHEST:UPDATEWEIGHT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("chest:UpdateWeight")
AddEventHandler("chest:UpdateWeight",function(invPeso,invMaxpeso,chestPeso,chestMaxpeso)
	SendNUIMessage({ action = "updateWeight", invPeso = invPeso, invMaxpeso = invMaxpeso, chestPeso = chestPeso, chestMaxpeso = chestMaxpeso })
end)